# Plan de D√©veloppement - ProcessMetaLanguage Templates & Scripts

**Version** : 1.0.0  
**Date** : 2025-01-18  
**Auteur** : Rolland MELET & Claude Code  
**Objectif** : Cr√©er un syst√®me de templates BackOfTheCard pour enrichir les dessins Excalidraw avec des m√©tadonn√©es ProcessMetaLanguage v2.3

---

## üéØ Vue d'Ensemble

### Contexte
Enrichir des dessins Excalidraw existants avec des fichiers embedded standardis√©s qui d√©crivent de fa√ßon structur√©e les √©l√©ments d'un workflow selon le ProcessMetaLanguage v2.3.

### Concept "BackOfTheCard"
- **Face Avant** : √âl√©ment visuel dessin√© par l'utilisateur dans Excalidraw
- **Face Arri√®re** : Fichier markdown embarqu√© avec m√©tadonn√©es structur√©es

### Hi√©rarchie ProcessMetaLanguage v2.3
```
üèóÔ∏è WORKFLOW (orchestration globale)
    ‚îî‚îÄ‚îÄ üìÑ PROCESSUS (cycle de vie d'UN objet)
        ‚îî‚îÄ‚îÄ üè≥Ô∏è √âTAT (situation instantan√©e)
            ‚îî‚îÄ‚îÄ üé≠ COMPORTEMENT (patterns r√©utilisables)
                ‚îî‚îÄ‚îÄ ‚öôÔ∏è ACTION (d√©clencheur de transition)
                    ‚îî‚îÄ‚îÄ üì± VUE/AFFICHAGE (UI/wireframe)
```

---

## üîë Principe Fondamental : Gestion des Propri√©t√©s

### Types de Propri√©t√©s

#### 1. SYSTEM (Cr√©√©es automatiquement par 360SmartConnect)
```yaml
source: "system"
dynamic: false
exemples: [id, uid, url_propre, created_at]
```

#### 2. USER (Saisies par l'utilisateur)
```yaml
source: "user"
dynamic: true|false
required: true|false
prompt: "Message pour l'utilisateur"
```

#### 3. DEFAULT (Valeurs par d√©faut)
```yaml
source: "default"
dynamic: true|false
default_value: null|value
update_triggers: ["action1", "action2"]
```

#### 4. DYNAMIC (Modifiables par actions)
```yaml
dynamic: true
update_triggers: ["*"] # ou liste sp√©cifique
validation: "r√®gles de validation"
```

### Structure de M√©tadonn√©es pour Chaque Propri√©t√©
```yaml
property_metadata:
  source: "system|user|default"
  dynamic: true|false
  required: true|false
  default_value: null|value
  update_triggers: []
  prompt: "Question √† poser"
  validation: "R√®gles"
```

---

## üì¶ PHASE 1 : TEMPLATE OBJET (Semaine 1)

### Objectif
Cr√©er le template de base pour les objets avec gestion compl√®te des propri√©t√©s dynamiques.

### Template : template-objet-backofcard.md

#### Structure YAML Front Matter
```yaml
---
excalidraw-plugin: parsed
type: "template-objet"
template_version: "1.0.0"
processmetalanguage_version: "2.3"

property_definitions:
  # PROPRI√âT√âS SYST√àME
  id:
    source: "system"
    dynamic: false
    description: "UUID g√©n√©r√© par 360SmartConnect"
    
  uid:
    source: "system"
    dynamic: false
    description: "Identifiant unique court"
    
  url_propre:
    source: "system"
    dynamic: false
    description: "URL permanente /objects/{uid}"
    
  created_at:
    source: "system"
    dynamic: false
    
  # PROPRI√âT√âS UTILISATEUR
  nom:
    source: "user"
    dynamic: false
    required: true
    prompt: "Nom de l'objet:"
    
  description:
    source: "user"
    dynamic: true
    required: false
    prompt: "Description (optionnelle):"
    
  proprietes_metier:
    source: "user"
    dynamic: true
    required: false
    type: "json"
    prompt: "Propri√©t√©s m√©tier sp√©cifiques"
    
  # PROPRI√âT√âS PAR D√âFAUT
  processus_objet_id:
    source: "default"
    dynamic: true
    default_value: null
    update_triggers: ["assign_to_process"]
    
  etat_actuel_id:
    source: "default"
    dynamic: true
    default_value: null
    update_triggers: ["state_transition"]
    validation: "Si processus_objet_id existe, obligatoire"
    
  workflow_parent_id:
    source: "default"
    dynamic: true
    default_value: null
    update_triggers: ["attach_to_workflow"]
    
  historique:
    source: "default"
    dynamic: true
    default_value: []
    update_triggers: ["*"]
---
```

### Script : create-object-backofcard.md

#### Fonctionnalit√©s
1. Collecte des propri√©t√©s USER via prompts interactifs
2. G√©n√©ration automatique des propri√©t√©s SYSTEM
3. Application des valeurs DEFAULT
4. Cr√©ation du fichier embedded avec validation
5. Historique des modifications

### Tests Phase 1
- [ ] Cr√©er 3 objets diff√©rents
- [ ] V√©rifier g√©n√©ration des UIDs uniques
- [ ] Valider les m√©tadonn√©es YAML
- [ ] Tester la r√®gle processus‚Üí√©tat

---

## üè≥Ô∏è PHASE 2 : TEMPLATE √âTAT (Semaine 2)

### Objectif
G√©rer les √©tats avec classification et transitions dynamiques.

### Template : template-etat-backofcard.md

#### Propri√©t√©s Sp√©cifiques
```yaml
property_definitions:
  nom_etat:
    source: "user"
    required: true
    prompt: "Nom de l'√©tat:"
    
  type_etat:
    source: "user"
    required: true
    prompt: "Type d'√©tat:"
    options: ["initial", "intermediaire", "final"]
    
  processus_parent_id:
    source: "user"
    dynamic: false
    required: true
    
  transitions:
    source: "default"
    dynamic: true
    default_value:
      predecesseurs: []
      successeurs: []
    update_triggers: ["connect_states"]
    
  conditions_entree:
    source: "user"
    dynamic: true
    
  actions_sortie:
    source: "default"
    dynamic: true
    default_value: []
    update_triggers: ["add_exit_action"]
```

### Script : add-state-to-object.md

#### Fonctionnalit√©s
1. S√©lection objet existant via suggester
2. Classification automatique selon position
3. Mise √† jour objet.etat_actuel_id
4. Connexion visuelle par fl√®ches
5. Validation coh√©rence transitions

### Tests Phase 2
- [ ] Ajouter √©tat initial √† un objet
- [ ] Cr√©er cha√Æne de 3 √©tats
- [ ] V√©rifier transitions bidirectionnelles
- [ ] Tester √©tat final

---

## üé≠ PHASE 3 : TEMPLATES COMPORTEMENT & ACTION (Semaine 3)

### Template : template-comportement-backofcard.md

#### Propri√©t√©s Comportement
```yaml
property_definitions:
  nom_comportement:
    source: "user"
    required: true
    
  sections_ui:
    source: "user"
    dynamic: true
    type: "array"
    prompt: "Sections d'interface:"
    
  actions_disponibles:
    source: "default"
    dynamic: true
    default_value: []
    update_triggers: ["add_action", "remove_action"]
    
  est_template_reutilisable:
    source: "user"
    type: "boolean"
    prompt: "Template r√©utilisable?"
```

### Template : template-action-backofcard.md

#### Propri√©t√©s Action
```yaml
property_definitions:
  nom_action:
    source: "user"
    required: true
    
  declencheur:
    source: "user"
    required: true
    options: ["bouton", "automatique", "condition"]
    
  proprietes_modifiees:
    source: "user"
    prompt: "Propri√©t√©s √† modifier:"
    validation: "V√©rifier dynamic:true"
    
  script_modification:
    source: "user"
    dynamic: true
    type: "javascript"
    
  log_modifications:
    source: "default"
    default_value: true
```

### Scripts
- attach-behavior-to-state.md
- add-action-to-behavior.md

### Tests Phase 3
- [ ] Cr√©er comportement avec 2 actions
- [ ] Tester modification propri√©t√© dynamique
- [ ] Valider logging des transitions
- [ ] V√©rifier template r√©utilisable

---

## üì± PHASE 4 : TEMPLATE VUE/AFFICHAGE (Semaine 3)

### Template : template-vue-backofcard.md

#### Propri√©t√©s Vue
```yaml
property_definitions:
  type_vue:
    source: "user"
    required: true
    options: ["formulaire", "dashboard", "liste", "wireframe"]
    
  proprietes_affichees:
    source: "user"
    dynamic: true
    validation: "V√©rifier existence dans objet"
    
  proprietes_editables:
    source: "user"
    dynamic: true
    validation: "V√©rifier dynamic:true"
    
  layout:
    source: "user"
    type: "wireframe"
    prompt: "Dessiner le wireframe"
```

### Script : link-view-to-behavior.md

### Tests Phase 4
- [ ] Cr√©er vue formulaire
- [ ] Lier vue √† comportement
- [ ] Tester propri√©t√©s √©ditables
- [ ] Valider wireframe

---

## üìã PHASE 5 : TEMPLATE PROCESSUS (Semaine 4)

### Template : template-processus-backofcard.md

#### Propri√©t√©s Processus
```yaml
property_definitions:
  nom_processus:
    source: "user"
    required: true
    
  objet_cible_id:
    source: "user"
    required: true
    validation: "Objet doit exister"
    
  etats_processus:
    source: "default"
    dynamic: true
    default_value: []
    update_triggers: ["add_state", "remove_state"]
    
  regles_transition:
    source: "user"
    dynamic: true
    
  proprietes_modifiables:
    source: "user"
    validation: "Toutes doivent √™tre dynamic:true"
```

### Script : create-process-for-object.md

### Tests Phase 5
- [ ] Cr√©er processus avec 5 √©tats
- [ ] Valider encha√Ænement logique
- [ ] Tester r√®gles transition
- [ ] V√©rifier coh√©rence globale

---

## üèóÔ∏è PHASE 6 : TEMPLATE WORKFLOW (Semaine 4)

### Template : template-workflow-backofcard.md

#### Propri√©t√©s Workflow
```yaml
property_definitions:
  nom_workflow:
    source: "user"
    required: true
    
  processus_orchestres:
    source: "default"
    dynamic: true
    default_value: []
    update_triggers: ["add_process", "remove_process"]
    
  points_synchronisation:
    source: "user"
    dynamic: true
    type: "sync_points"
    
  propagation_modifications:
    source: "user"
    dynamic: true
    type: "rules_engine"
```

### Script : create-workflow-orchestration.md

### Tests Phase 6
- [ ] Orchestrer 3 processus
- [ ] D√©finir points synchronisation
- [ ] Tester propagation modifications
- [ ] Valider orchestration compl√®te

---

## üìù PHASE 7 : TRANSFORMATION CANVAS‚ÜíMARKDOWN (Semaine 5)

### Script : canvas-to-processmetalanguage.md

#### Fonctionnalit√©s
1. Parser hi√©rarchie compl√®te du canvas
2. Extraire toutes les m√©tadonn√©es
3. G√©n√©rer documentation ProcessMetaLanguage v2.3
4. Export Dataview-ready
5. Validation contraintes et r√®gles

### Structure Export
```markdown
# Documentation ProcessMetaLanguage v2.3

## Workflow : {nom}
### Processus orchestr√©s
- Processus 1
  - √âtats
  - Transitions
- Processus 2

## Objets
### Objet 1
- Propri√©t√©s
- √âtat actuel
- Historique

## Requ√™tes Dataview
\`\`\`dataview
TABLE nom, etat_actuel_id, processus_objet_id
FROM "ProcessMetaLanguage"
WHERE type = "objet"
\`\`\`
```

### Tests Phase 7
- [ ] Transformer canvas simple
- [ ] Exporter workflow complet
- [ ] Valider structure markdown
- [ ] Tester requ√™tes Dataview

---

## üìÅ Structure Finale des Fichiers

```
ProcessMetaLanguage/
‚îú‚îÄ‚îÄ Templates/
‚îÇ   ‚îî‚îÄ‚îÄ BackOfCard/
‚îÇ       ‚îú‚îÄ‚îÄ template-objet-backofcard.md
‚îÇ       ‚îú‚îÄ‚îÄ template-etat-backofcard.md
‚îÇ       ‚îú‚îÄ‚îÄ template-comportement-backofcard.md
‚îÇ       ‚îú‚îÄ‚îÄ template-action-backofcard.md
‚îÇ       ‚îú‚îÄ‚îÄ template-vue-backofcard.md
‚îÇ       ‚îú‚îÄ‚îÄ template-processus-backofcard.md
‚îÇ       ‚îî‚îÄ‚îÄ template-workflow-backofcard.md
‚îÇ
‚îú‚îÄ‚îÄ Scripts/
‚îÇ   ‚îú‚îÄ‚îÄ create-object-backofcard.md
‚îÇ   ‚îú‚îÄ‚îÄ add-state-to-object.md
‚îÇ   ‚îú‚îÄ‚îÄ attach-behavior-to-state.md
‚îÇ   ‚îú‚îÄ‚îÄ add-action-to-behavior.md
‚îÇ   ‚îú‚îÄ‚îÄ link-view-to-behavior.md
‚îÇ   ‚îú‚îÄ‚îÄ create-process-for-object.md
‚îÇ   ‚îú‚îÄ‚îÄ create-workflow-orchestration.md
‚îÇ   ‚îî‚îÄ‚îÄ canvas-to-processmetalanguage.md
‚îÇ
‚îú‚îÄ‚îÄ Examples/
‚îÇ   ‚îú‚îÄ‚îÄ workflow-fabrication-moteur-bmw.md
‚îÇ   ‚îî‚îÄ‚îÄ objet-bloc-moteur-exemple.md
‚îÇ
‚îî‚îÄ‚îÄ Tests/
    ‚îú‚îÄ‚îÄ test-phase1-objets.md
    ‚îú‚îÄ‚îÄ test-phase2-etats.md
    ‚îú‚îÄ‚îÄ test-phase3-comportements.md
    ‚îú‚îÄ‚îÄ test-phase4-vues.md
    ‚îú‚îÄ‚îÄ test-phase5-processus.md
    ‚îú‚îÄ‚îÄ test-phase6-workflows.md
    ‚îî‚îÄ‚îÄ test-phase7-transformation.md
```

---

## üîß Fonctions Utilitaires Communes

### Validation des Propri√©t√©s Dynamiques
```javascript
function validateDynamicUpdate(property, action, template) {
    const propertyDef = template.property_definitions[property];
    
    if (!propertyDef.dynamic) {
        throw new Error(`Propri√©t√© ${property} non modifiable`);
    }
    
    if (propertyDef.update_triggers && 
        !propertyDef.update_triggers.includes(action) &&
        !propertyDef.update_triggers.includes("*")) {
        throw new Error(`Action ${action} non autoris√©e pour ${property}`);
    }
    
    return true;
}
```

### Historique des Modifications
```javascript
function logPropertyChange(objet, property, oldValue, newValue, action) {
    objet.historique.push({
        timestamp: new Date().toISOString(),
        property: property,
        old_value: oldValue,
        new_value: newValue,
        action: action,
        user: contexte.user
    });
}
```

### Collecte des Propri√©t√©s Utilisateur
```javascript
async function collectUserProperties(template) {
    const properties = {};
    
    for (const [key, def] of Object.entries(template.property_definitions)) {
        if (def.source === "user") {
            if (def.options) {
                properties[key] = await utils.suggester(
                    def.options,
                    def.options,
                    false,
                    def.prompt
                );
            } else if (def.type === "boolean") {
                properties[key] = await utils.confirm(def.prompt);
            } else if (def.type === "json") {
                const jsonStr = await utils.inputPrompt(
                    def.prompt + "\n(Format JSON)",
                    "{}"
                );
                properties[key] = JSON.parse(jsonStr);
            } else {
                properties[key] = await utils.inputPrompt(
                    def.prompt,
                    def.default_value || ""
                );
            }
            
            if (def.required && !properties[key]) {
                throw new Error(`${key} est obligatoire`);
            }
        }
    }
    
    return properties;
}
```

---

## üéØ Crit√®res de Succ√®s

### Par Phase
1. ‚úÖ Templates cr√©ent les bons embeds
2. ‚úÖ M√©tadonn√©es YAML conformes v2.3
3. ‚úÖ Scripts g√®rent les relations
4. ‚úÖ Propri√©t√©s dynamiques fonctionnelles
5. ‚úÖ Historique complet trac√©
6. ‚úÖ Export markdown structur√©
7. ‚úÖ Requ√™tes Dataview op√©rationnelles

### Global
- [ ] Respect hi√©rarchie ProcessMetaLanguage
- [ ] Validation r√®gles fondamentales
- [ ] Interface utilisateur intuitive
- [ ] Documentation compl√®te
- [ ] Tests exhaustifs

---

## üìÖ Planning

| Phase | Semaine | Livrable Principal |
|-------|---------|-------------------|
| 1 | S1 | Template & Script OBJET |
| 2 | S2 | Template & Script √âTAT |
| 3 | S3 | Templates COMPORTEMENT & ACTION |
| 4 | S3 | Template VUE/AFFICHAGE |
| 5 | S4 | Template PROCESSUS |
| 6 | S4 | Template WORKFLOW |
| 7 | S5 | Script Transformation |

---

## üöÄ Prochaines √âtapes

1. **Imm√©diat** : Cr√©er template-objet-backofcard.md
2. **Jour 2** : D√©velopper create-object-backofcard.md
3. **Jour 3** : Tests et validation Phase 1
4. **Jour 4** : Commencer Phase 2

---

## üìù Notes

- L'utilisateur dessine les √©l√©ments visuels
- Le syst√®me g√®re les m√©tadonn√©es
- Tout est trac√© dans l'historique
- Les propri√©t√©s dynamiques permettent l'√©volution
- La validation est stricte mais flexible

---

**Fin du document plan.md**